---
version: "3.7"

services:
  tests:
    build:
      context: .
      dockerfile: Dockerfile.tests
      network: ${NETWORK:-default}
    volumes:
      - tests:/tests
  test:
    image: ${REGISTRY}/${REPOSITORY}:${IMAGE_TAG:-latest}
    ports: [8787:8787]
    network_mode: ${NETWORK}
    volumes:
      - tests:/share/tests
  inspec:
    image: chef/inspec:current
    network_mode: ${NETWORK}
    environment:
      CHEF_LICENSE: accept-no-persist
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - tests:/share/tests:ro

volumes:
  tests:
